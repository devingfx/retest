<!doctype html>
<html lang=en class=content dir=ltr>
<meta charset=UTF-8>
<title>MD docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1">



<main>
	<div class="content container">./README.md</div>
</main>

<script type=module>

	
	const DEBUG = /debug/.test( location.search )
	
	const log = DEBUG
					? ss=> (...a)=> console.log( ss.join(''), ...a) || a[0]
					: ss=> o=>o
	
	
	
	const $container = document.querySelector`main .container`
	
	const init = ()=> {
// // 		const state = {
// 			title: document.title,
// 			url: $container.textContent
// 		}
// 		history.replaceState( state, state.title, state.url )
// 		onpopstate({ state })
		loadPage( $container.textContent, document.location )
// 		for (const link of document.links) {
// 		    link.onclick = processLink
// 		}
		
	}
	
	const loadPage = ( url, href = url )=> fetch( url.slice(-1) == '/' ? url+'index.md' : url ).then( res=> res.text() )
				.then( src=> ({ href, title: `DM docs - ${url}`, url, src }) )
				.then( ({ href, title, url, src })=> {
					history.pushState( { href, title, url, src }, title, href )
					onpopstate({ state: { href, title, url, src } })
				})
	
	document.addEventListener('click', e=>{
		//e.preventDefault()
		const target = e.target instanceof HTMLAnchorElement ? e.target : e.target.closest('a[href]')
		if( !target ) return true
		
		const isInternal = ( new URL(target.href) ).origin == location.origin
		console.log( e.target, target, target.href, isInternal )
		if( !isInternal ) return true
		e.preventDefault()
		loadPage( target.href )
		return false
	})
	window.onpopstate = e=> {
		document.title = e.state.title
		$container.innerHTML = e.state.src
	}
	/*window.onhashchange = async e=> {
		
		const url = `/retest/${location.hash.slice(1)}.md`
    
		let src = await loadPage( url )
		
		$container.innerHTML = src
		document.title = `DM docs - ${url}`
	}
	
	!location.hash
		// ? ( location.hash = '#String&DOM&EventojLancilo&SVG' )
		? ( location.hash = '#README' )
		: requestAnimationFrame( onhashchange )
	*/
	window.addEventListener( "load", init, false )
	
	Object.assign( window, {
		loadPage,
		init
	})
</script>


<main>
	<div class="content container"></div>
</main>

